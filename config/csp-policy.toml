# Content Security Policy Configuration
# OWASP Top 10 A1: Injection Prevention

# Base CSP Policy
base-csp = [
    "default-src 'self'",
    "script-src 'self' 'unsafe-inline' https://www.google.com https://www.gstatic.com https://cdnjs.cloudflare.com",
    "style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com",
    "font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com",
    "img-src 'self' data: https://images.unsplash.com https://*.unsplash.com",
    "connect-src 'self'",
    "frame-ancestors 'none'",
    "base-uri 'self'",
    "form-action 'self'",
    "upgrade-insecure-requests",
    "block-all-mixed-content"
]

# Strict CSP Policy (for production)
strict-csp = [
    "default-src 'self'",
    "script-src 'self' https://www.google.com https://www.gstatic.com https://cdnjs.cloudflare.com",
    "style-src 'self' https://fonts.googleapis.com https://cdnjs.cloudflare.com",
    "font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com",
    "img-src 'self' https://images.unsplash.com https://*.unsplash.com",
    "connect-src 'self'",
    "frame-ancestors 'none'",
    "base-uri 'self'",
    "form-action 'self'",
    "upgrade-insecure-requests",
    "block-all-mixed-content",
    "require-trusted-types-for 'script'"
]

# Report-Only CSP (for testing)
report-only-csp = [
    "default-src 'self'",
    "script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.google.com https://www.gstatic.com https://cdnjs.cloudflare.com",
    "style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com",
    "font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com",
    "img-src 'self' data: https://images.unsplash.com https://*.unsplash.com https: data:",
    "connect-src 'self' https://www.google-analytics.com",
    "frame-ancestors 'none'",
    "base-uri 'self'",
    "form-action 'self'",
    "upgrade-insecure-requests",
    "report-uri https://csp-report.hairathome.ca/api/csp-report"
]

# CSP Hashes for Inline Scripts
script-hashes = [
    "sha256-xyz123",  # Add actual hashes for inline scripts
    "sha256-abc456"   # Generate with: echo -n "script-content" | openssl dgst -sha256 -binary | openssl base64
]

# CSP Nonces for Dynamic Content
nonce-config = { enabled = true, length = 16, refresh_interval = "1h" }

# CSP Violation Reporting
csp-reporting = { enabled = true, endpoint = "https://csp-report.hairathome.ca/api/csp-report", report_only = false, sample_rate = 1.0 }

# Environment-specific CSP
[environments.development]
csp-policy = "report-only-csp"
report-violations = true
allow-unsafe-inline = true
allow-unsafe-eval = true

[environments.staging]
csp-policy = "base-csp"
report-violations = true
allow-unsafe-inline = false
allow-unsafe-eval = false

[environments.production]
csp-policy = "strict-csp"
report-violations = false
allow-unsafe-inline = false
allow-unsafe-eval = false

# CSP for Different Content Types

[content-types.html]
csp-policy = "strict-csp"
additional-directives = [
    "object-src 'none'",
    "base-uri 'self'",
    "manifest-src 'self'"
]

[content-types.api]
csp-policy = [
    "default-src 'none'",
    "script-src 'none'",
    "style-src 'none'",
    "img-src 'none'",
    "font-src 'none'",
    "connect-src 'self'",
    "frame-ancestors 'none'",
    "base-uri 'none'",
    "form-action 'none'"
]

[content-types.assets]
csp-policy = [
    "default-src 'none'",
    "script-src 'none'",
    "style-src 'self'",
    "img-src 'self'",
    "font-src 'self'",
    "connect-src 'none'",
    "frame-ancestors 'none'"
]

# CSP Bypass Prevention
[bypass-prevention]
prevent-jsonp = true
prevent-callback = true
validate-redirects = true
sanitize-outputs = true

# CSP Monitoring and Alerts
[monitoring]
real-time-alerts = true
violation-threshold = 10
alert-endpoints = [
    "https://alerts.hairathome.ca/webhook/csp",
    "security@hairathome.ca"
]

# CSP Compliance
[compliance]
owasp-csp-level = "Level 2"
iso-27001-compliant = true
pci-dss-compliant = false
gdpr-compliant = true